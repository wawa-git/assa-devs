package com.assaassociates.syraway.exts.mbeans;

import java.util.ArrayList;
import java.util.List;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.SessionScoped;
import javax.faces.context.FacesContext;
import javax.faces.event.AjaxBehaviorEvent;
import org.springframework.context.ApplicationContext;
import org.springframework.web.jsf.FacesContextUtils;
import com.assaasoociates.syraway.controller.IBusinessUnitExController;
import com.assaasoociates.syraway.controller.IBusinessUnitPcController;
import com.assaasoociates.syraway.controller.IDepartmentController;
import com.assaasoociates.syraway.controller.IProjectController;
import com.assaassociates.syraway.model.BusinessUnitEx;
import com.assaassociates.syraway.model.Department;
import com.assaassociates.syraway.model.Project;

@ManagedBean(name="department")
@SessionScoped
public class ProjectServiceImpl implements IProjectService {

private static final long serialVersionUID = 6726658729223350876L;
	

	private IProjectController oProjectController;
	private IBusinessUnitPcController oBuPcController;
	private Project value;
	private List<Project> projectList;
	private String buPc;
	private String managerId;
	private String projectId;
	
	public ProjectServiceImpl(){
		super(); 
		ApplicationContext appContext = FacesContextUtils.getWebApplicationContext(FacesContext.getCurrentInstance());
		this.oProjectController = appContext.getBean("projectController", IProjectController.class);
		this.oBuPcController = appContext.getBean("buPcController", IBusinessUnitPcController.class);
		this.value = new Project();
		this.projectList = new ArrayList<Project>();
	}

	public IProjectController getProjectController() {
		return oProjectController;
	}

	public void setProjectController(IProjectController oProjectController) {
		this.oProjectController = oProjectController;
	}

	public IBusinessUnitPcController getBuPcController() {
		return oBuPcController;
	}

	public void setBuPcController(IBusinessUnitPcController oBuPcController) {
		this.oBuPcController = oBuPcController;
	}

	public Project getValue() {
		return value;
	}

	public void setValue(Project value) {
		this.value = value;
	}

	public List<Project> getProjectList() {
		return projectList;
	}

	public void setProjectList(List<Project> projectList) {
		this.projectList = projectList;
	}

	public String getBuPc() {
		return buPc;
	}

	public void setBuPc(String buPc) {
		this.buPc = buPc;
	}

	public String getManagerId() {
		return managerId;
	}

	public void setManagerId(String managerId) {
		this.managerId = managerId;
	}

	public String getProjectId() {
		return projectId;
	}

	public void setProjectId(String pProjectId) {
		this.projectId = pProjectId;
		if(this.projectId != null){
			if(getProjectController() != null){
				value = getProjectController().getProject(this.projectId);
				if(value != null){
					setBuPc(String.valueOf(value.getSwBuPc().getBuPcId()));
					setManagerId(String.valueOf(value.getSwEmployee().getEmplId()));
				}
			}
		}
	}

	public void addProject(){
		if(this.oProjectController != null){
			if(getBuPc() != null){
				value.setSwBuPc(getBuPcController().getBuPc(Integer.parseInt(getBuPc())));
			}
			if(getManagerId() != null){
				value.setSwBuPc(getBuPcController().getBuPc(Integer.parseInt(getBuPc())));
			}
			this.oProjectController.addProject(value);
			
		}
	}

	@Override
	public void listDepartmentListener(AjaxBehaviorEvent event) {
		if(oDepartmentController != null){
			departmentList = oDepartmentController.getAllDepts();
		}
	}

	@Override
	public List<BusinessUnitEx> getAllBuEx() {
		if(oDepartmentController != null){
			return oDepartmentController.getAllBuEx();
		}
		return new ArrayList<BusinessUnitEx>();
	}

	
}
