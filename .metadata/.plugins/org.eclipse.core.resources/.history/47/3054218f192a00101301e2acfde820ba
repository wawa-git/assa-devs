/**
 * 
 */
package com.assaasoociates.syraway.controller;

import java.util.ArrayList;
import java.util.List;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Isolation;
import org.springframework.transaction.annotation.Transactional;

import com.assaassociates.syraway.dao.IPageDAO;
import com.assaassociates.syraway.model.Page;
import com.assaassociates.syraway.model.PageRole;

/**
 * @author waheb
 *
 */

@Component("pageController")
public class PageControllerImpl implements IPageController {

	@Autowired
	private IPageDAO pageDAO;
	
	public IPageDAO getPageDAO() {
		return pageDAO;
	}

	public void setPageDAO(IPageDAO roleDAO) {
		this.pageDAO = roleDAO;
	}

	public void addPage(Page pPage) {
		if(pageDAO != null){
			pageDAO.addPage(pPage);
		}
	}

	public void updatePage(Page pPage) {
		if(pageDAO != null){
			pageDAO.updatePage(pPage);
		}
	}

	public Page getPage(Integer pPageId) {
		Page result = null;
		if(pageDAO != null){
			result = pageDAO.getPageById(pPageId);
		}
		return result;
	}

	public List<Page> getAllPages() {
		List<Page> result = new ArrayList<Page>();
		if(pageDAO != null)
			result = pageDAO.getAllPages();
		return result;
	}

	@Transactional(isolation=Isolation.READ_COMMITTED)
	public List<Page> getAllVisibleMenus() {
		List<Page> oPages = new ArrayList<Page>();
		List<Page> oResult = new ArrayList<Page>();
		if(pageDAO != null)
			oPages = pageDAO.getAllPages();
		
		for (Page oPage : oPages) {
			if(oPage.isMenu()){
				Set<PageRole> oRoles = oPage.getSwPages();
				for (PageRole oPageRole : oRoles) {
					if(!oPageRole.getSwRole().getName().endsWith("ADMIN")){
						oResult.add(oPage);
						break;
					}
				}
			}
		
		}
		return oResult;
	}

	public Page getPageFromName(String pPageName) {
		Page result = null;
		if(pageDAO != null)
			result = pageDAO.getPageByName(pPageName);
		return result;
	}
}
